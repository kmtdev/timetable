(function(c){var e=c.document,g=c.location,k=c.navigator,l=c.localStorage,m=function(){c.addEventListener("hashchange",this.match.bind(this),!1)},n=function(a,b){this.endpoint=a;this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",b,!1);this.xhr.addEventListener("error",b,!1)},h=function(a){a=a.innerHTML;a=a.replace(/\s{2,}/g,"");a=a.replace(/\{\{(.*?)\}\}/g,"',$1,'");a=a.split("{%").join("');");a=a.split("%}").join("a.push('");a="var a=[];a.push('{}');return a.join('');".format(a);this.range=
e.createRange();this.source=new Function(a)},d=function(){e.addEventListener("mousedown",d.start.bind(this),!1);e.addEventListener("mousemove",d.move.bind(this),!1);e.addEventListener("mouseup",d.end.bind(this),!1);e.addEventListener("touchstart",d.start.bind(this),!1);e.addEventListener("touchmove",d.move.bind(this),!1);e.addEventListener("touchend",d.end.bind(this),!1)},f=c.$={endpoint:"https://hku-timetable.herokuapp.com/{group}/{date}",days:{},date:new Date,main:function(){var a=f.date.format("M"),
b=f.date.getDate();this.gesture=new d;this.router=new m;this.request=new n(this.endpoint,this.callback.bind(this));this.list=new h(c.list);this.again=new h(c.again);this.days[a+(b-1)]="Yesterday";this.days[a+b]="Today";this.days[a+(b+1)]="Tomorrow";this.router.match();/iPod|iPhone/.test(k.userAgent)&&!k.standalone&&c.add.classList.add("show");c.group.addEventListener("change",this.changeGroup.bind(this),!1)},changeGroup:function(a){a.target.blur();l.group=this.group=a.target.value;g.hash="#!/{}".format(a.target.value)},
scroll:function(){var a=e.querySelector(".today");null!==a?a.scrollIntoView():c.scrollTo(0,100)},parse:function(a){return a&&(a=JSON.parse(a))?a.map(function(a){return{date:f.date=new Date(a.date),blocks:a.blocks.map(function(a){return{from:new Date(a.from),to:new Date(a.to),lessons:a.lessons}})}}):!1},callback:function(a){var b=c.root,d=b.children[0],e=this.parse(a.target.response);a=200===a.target.status&&e?this.list.render(b,e):this.again.render(b);b.classList.remove("prev");b.classList.remove("next");
b.classList.remove("loading");void 0===d?b.appendChild(a):b.replaceChild(a,d);this.scroll()},setDate:function(a){this.date=new Date(this.date.getTime()+864E5*a);g.hash="#!/{}/{}".format(this.group,this.date.format("d-m-Y"))}};n.prototype.get=function(a){c.root.classList.add("loading");this.xhr.open("GET",this.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");this.xhr.send(null)};m.prototype.match=function(){var a=g.hash.split("#!/")[1];void 0!==a&&(this.route=a.split("/"))[0]?
(f.request.get({group:this.route[0],date:this.route[1]||(new Date).format("d-m-Y")}),c.group.value=f.group=this.route[0]):g.hash="#!/{}".format(l.group||"GDD1-B")};h.prototype.render=function(a,b){this.range.selectNode(a);return this.range.createContextualFragment(this.source.call(b))};d.start=function(a){a=a.touches?a.touches[0]:a;this.can=!0;this.start={x:a.clientX,y:a.clientY}};d.move=function(a){a=a.touches?a.touches[0]:a;if(this.can&&100>Math.abs(a.clientY-this.start.y)){a=a.clientX-this.start.x;
var b=e.body.clientWidth/3;a<-b&&(this.can=!1,c.root.classList.add("next"),f.setDate(7));a>b&&(this.can=!1,c.root.classList.add("prev"),f.setDate(-7))}};d.end=function(){this.can=!1};c.addEventListener("DOMContentLoaded",f.main.bind(f),!1)})(this);